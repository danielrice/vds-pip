<%#
Authors: Jeff Cox, David Zhang
Copyright Syracuse University
%>

<%= div_for(@document, :class => "modal-dialog") do %>
  <h1>
  <%= image_tag(@document.icon_path, :class => "main-icon") %><input data-in-place-edit="true" id="document_name" name="document[name]" size="30" type="text" value="<%= @document.name %>" /></h1>
  <div class="info">
    <div class="basic-info">
      <% unless @document.description.blank? %>
      <p class="description"><%= @document.description %></p>
      <% end %>
      <ul class="metadata">
      <li>Task: <%= @document.task || "(none)" %>
      <li>Stage: <%= @document.stage || "(none)" %>
      <li>Factor: <%= @document.factor || "(none)" %>
      <li>Actors: [to be implemented]</li>
      </ul>
    </div>
    <% if @document.upstream_items.size > 0 %>
      <h2>This document depends on:</h2>
      <ul class="dependencies">
      <% @document.upstream_dependencies.map{|upstream_dependency| [upstream_dependency, upstream_dependency.upstream_item] }.each do |upstream_dependency, upstream_item| %>
        <% content_tag(:li, :class => (dom_id(upstream_item) == flash[:new_dependency] ? "new-dependency" : "")) do %>
          <%= link_to("x", upstream_dependency, :method => :delete) %>
          <% link_to(upstream_item) do %>
            <%= image_tag(upstream_item.icon_path, :size => '15x15') %><%= upstream_item.name %>
          <% end %>
        <% end %>
      <% end %>
      </ul>
      <div id="add-another-dependency"><%= link_to("add another dependency", new_document_dependency_path(@document)) %></div>
    <% end %>
    <table class="versions">
      <caption>All versions:</caption>
      <tr>
        <th></th>
        <th>Name</th>
        <th>Author</th>
        <th>Created on</th>
    <% @document.versions.each do |version| %>
      <tr>
        <td><%= image_tag version.icon_path, :size => '15x15' %></td>
        <td><%= link_to version.name, version %></td>
        <td>[author]</td>
        <td><%= version.created_at.to_s(:long) %></td>
      </tr>
    <% end %>
    </table>
  </div>
  <div class="actions">
    <%= link_to("Download", @document.latest_version, :class => 'btn') %>
    <%= link_to("Update", new_document_version_path(@document), :class => 'btn') %>
    <%= link_to("Delete", @document, :confirm => 'Are you sure?', :method => :delete, :class => 'btn') %>
    <h2>Status:</h2>
    <ul class="radio">
      <% Document::STATUSES.each do |status| %>
        <li>
          <%= label_tag("document_status_#{status}", radio_button(:document, :status, status, "data-in-place-edit" => true) + status.humanize()) %>
        </li>
      <% end %>
    </ul>
  </div>
<% end %>
